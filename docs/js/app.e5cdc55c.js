(()=>{"use strict";var t={864:(t,e,o)=>{var i=o(471),s=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("Nav"),e("b-container",[e("b-row",[e("b-col",{attrs:{sm:"12",lg:"4"}},[e("Resume",{attrs:{totalSpent:t.round2decimals(t.totalSpent),totalMovies:t.totalMovies(),giftMovies:t.giftMovies(),unwatchedMovies:t.unwatchedMovies(),byFormat:t.countByFormat()}}),e("div",{staticClass:"mb-3"},[e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.add-movie-modal",modifiers:{"add-movie-modal":!0}}],attrs:{variant:"success",block:""}},[e("b-icon-plus"),t._v(" Añadir película")],1)],1),e("SuggestedMovie",{on:{showDetail:t.showMovieModal}})],1),e("b-col",{attrs:{sm:"12",lg:"8"}},[t.filteredResults.count?e("b-pagination",{staticClass:"mb-3",attrs:{"total-rows":t.filteredResults.count,"per-page":t.qtyPerPage,limit:10,align:"fill"},on:{change:t.changePage},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}):t._e(),e("b-list-group",[e("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center",attrs:{variant:"dark"}},[e("h4",{staticClass:"mb-0 d-inline-block"},[t._v("Mi colección")]),e("b-button",{attrs:{size:"sm",variant:t.showFilters?"light":""},on:{click:function(e){t.showFilters=!t.showFilters}}},[e("b-icon-filter")],1)],1),t.showFilters?e("b-list-group-item",{attrs:{variant:"light"}},[e("b-row",[e("b-col",{attrs:{cols:"12",md:"6"}},[e("b-input-group",{attrs:{size:"md",prepend:"Título"}},[e("b-form-input",{model:{value:t.filters.title,callback:function(e){t.$set(t.filters,"title",e)},expression:"filters.title"}})],1)],1),e("b-col",{attrs:{cols:"12",md:"6"}},[e("b-input-group",{attrs:{prepend:"Tienda"}},[e("b-form-select",{model:{value:t.filters.store,callback:function(e){t.$set(t.filters,"store",e)},expression:"filters.store"}},[e("b-form-select-option",{attrs:{value:""}}),t._l(t.stores,function(o,i){return e("b-form-select-option",{key:i,attrs:{value:i}},[t._v(t._s(o))])})],2)],1)],1)],1),e("b-row",{staticClass:"mt-2"},[e("b-col",{attrs:{cols:"12",md:"5"}},[e("b-input-group",{attrs:{prepend:"Precio"}},[e("b-form-select",{model:{value:t.filters.cost,callback:function(e){t.$set(t.filters,"cost",e)},expression:"filters.cost"}},[e("b-form-select-option",{attrs:{value:""}}),e("b-form-select-option",{attrs:{value:"0"}},[t._v("Gratis")]),e("b-form-select-option",{attrs:{value:"<5"}},[t._v("< 5€")]),e("b-form-select-option",{attrs:{value:"<10"}},[t._v("< 10€")]),e("b-form-select-option",{attrs:{value:"10&50"}},[t._v("> 10€ && < 50€")]),e("b-form-select-option",{attrs:{value:">50"}},[t._v("> 50€")])],1)],1)],1),e("b-col",{staticClass:"mt-2 mt-sm-0",attrs:{cols:"12",md:"5"}},[e("b-input-group",{attrs:{prepend:"Estrenada"}},[e("b-form-select",{model:{value:t.filters.watched,callback:function(e){t.$set(t.filters,"watched",e)},expression:"filters.watched"}},[e("b-form-select-option",{attrs:{value:null}},[t._v("Todas")]),e("b-form-select-option",{attrs:{value:!1}},[t._v("Sin estrenar")]),e("b-form-select-option",{attrs:{value:!0}},[t._v("Estrenadas")])],1)],1)],1)],1),e("b-row",{staticClass:"mt-2 text-center"},[e("b-col",[e("b-input-group",{attrs:{prepend:"Resultados por página"}},[e("b-form-select",{model:{value:t.qtyPerPage,callback:function(e){t.qtyPerPage=e},expression:"qtyPerPage"}},[e("b-form-select-option",{attrs:{value:15}},[t._v("15")]),e("b-form-select-option",{attrs:{value:50}},[t._v("50")]),e("b-form-select-option",{attrs:{value:100}},[t._v("100")])],1)],1)],1),e("b-col",[e("b-input-group",{attrs:{prepend:"Ordenar"}},[e("b-form-select",{model:{value:t.filters.sort.field,callback:function(e){t.$set(t.filters.sort,"field",e)},expression:"filters.sort.field"}},[e("b-form-select-option",{attrs:{value:"title"}},[t._v("Título")]),e("b-form-select-option",{attrs:{value:"cost"}},[t._v("Coste")]),e("b-form-select-option",{attrs:{value:"addDate"}},[t._v("Fecha añadida")])],1),e("b-form-select",{model:{value:t.filters.sort.order,callback:function(e){t.$set(t.filters.sort,"order",e)},expression:"filters.sort.order"}},[e("b-form-select-option",{attrs:{value:-1}},[t._v("Asc")]),e("b-form-select-option",{attrs:{value:1}},[t._v("Desc")])],1)],1)],1)],1),e("b-row",[e("b-col",[t._v("Resultados: "),e("strong",[t._v(t._s(t.filteredResults.count))])])],1)],1):t._e(),t.totalMovies()?t._e():e("b-list-group-item",{attrs:{variant:"secondary"}},[t._v("Aún no has añadido nada a tu colección :(")]),t.hasAnyFilter&&!t.filteredResults.count&&t.totalMovies()?e("b-list-group-item",{attrs:{variant:"warning"}},[t._v(" No hay resultados con estos filtros ")]):t._e(),t._l(t.filteredResults.items,function(o,i){return e("b-list-group-item",{key:i},[e("b-row",[e("b-col",{attrs:{md:"12"}},[e("div",{staticClass:"text-truncate text-left font-weight-bold"},[e("a",{directives:[{name:"b-modal",rawName:"v-b-modal.detail-movie-modal",modifiers:{"detail-movie-modal":!0}}],attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showMovie(o)}}},[t._v(t._s(o.title)+" ")])])]),e("b-col",{staticClass:"text-right",attrs:{md:"12"}},[e("b-row",{staticClass:"mt-3 mt-sm-0"},[e("b-col",{attrs:{cols:"6",sm:"8"}},[e("div",{staticClass:"mt-1 text-left"},[o.format?e("b-badge",{staticClass:"mr-2 pl-2 pr-2",attrs:{variant:"info"}},[t._v(t._s(t.formats[o.format]))]):t._e(),+o.watched?t._e():e("b-badge",{staticClass:"mr-2 pl-2 pr-2 text-uppercase",attrs:{variant:"warning"}},[t._v("Sin estrenar")]),e("b-badge",{staticClass:"mr-2 pl-2 pr-2",attrs:{variant:"success",title:`Coste: ${o.cost}€`}},[t._v(t._s(o.cost)+"€")])],1)]),e("b-col",{attrs:{cols:"6",sm:"4"}},[e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.edit-movie",modifiers:{"edit-movie":!0}}],staticClass:"mr-1",attrs:{variant:"info",size:"sm"},on:{click:function(e){return t.editMovie(o.id)}}},[e("b-icon-pencil"),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("Editar")])],1),e("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.removeMovie(o.id)}}},[e("b-icon-trash"),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("Eliminar")])],1)],1)],1)],1)],1)],1)})],2),t.filteredResults.count?e("b-pagination",{staticClass:"mt-3",attrs:{"total-rows":t.filteredResults.count,"per-page":t.qtyPerPage,limit:10,align:"fill"},on:{change:t.changePage},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}):t._e()],1)],1)],1),e("AddMovieModal"),e("OptionsModal"),e("EditModal",{attrs:{movie:t.editMovieData},on:{confirmEditMovie:t.confirmEditMovie,resetEditMovie:t.resetEditMovie}}),e("DetailModal",{attrs:{movie:t.detailMovie},on:{removeMovie:function(e){return t.removeMovie(e)},editMovie:function(e){return t.editMovie(e)}}})],1)},a=[],r=o(353);o(313),o(386);const l={methods:{formatMovie(t){return{id:t.id||"",title:t.title||"",cost:t.cost||0,store:t.store||"",imdbLink:t.imdbLink||"",addDate:t.addDate||new Date,watched:1===+t.watched||!0===t.watched||!1,format:t.format||"br"}},showToast(t,e,o){this.$bvToast.toast(e,{title:t,variant:o,solid:!0,toaster:"b-toaster-top-center"})},readImdbCSV:async function(t){const e=this.csvToArray(t);e.forEach(async(t,e)=>{if(0===e)return!1;const o=t[1],i=t[16],s=t[5],a=t[6];if(!o)return!1;this.$store.commit("addMovie",this.formatMovie({id:o,cost:0,store:"",addDate:new Date(i).getTime(),title:s,watched:!!i,imdbLink:a,format:"br"}))})},csvToArray(t){let e,o="",i=[""],s=[i],a=0,r=0,l=!0;for(e of t)'"'===e?(l&&e===o&&(i[a]+=e),l=!l):","===e&&l?e=i[++a]="":"\n"===e&&l?("\r"===o&&(i[a]=i[a].slice(0,-1)),i=s[++r]=[e=""],a=0):i[a]+=e,o=e;return s},round2decimals(t){return Math.round(100*(t+Number.EPSILON))/100},jsonToCsv(t){const e=t,o=(t,e)=>null===e?"":e.toString(),i=Object.keys(e[0]),s=encodeURI([i.join(","),...e.map(t=>i.map(e=>JSON.stringify(t[e],o)).join(","))].join("\n"));return console.log(s),s}}};var n=function(){var t=this,e=t._self._c;return t.movie.id?e("b-card",{staticClass:"mb-3"},[e("b-card-text",[e("strong",{staticClass:"mr-1"},[t._v("Película sugerida hoy:")]),e("a",{staticClass:"font-weight-bold",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("showDetail",t.movie)}}},[t._v(t._s(t.movie.title))]),+t.movie.watched?t._e():e("b-badge",{staticClass:"ml-1",attrs:{variant:"warning"}},[t._v("SIN ESTRENAR")])],1)],1):t._e()},c=[];const d={name:"SuggestedMovie",computed:{...(0,r.aH)(["movieCollection","suggestedToday"])},watch:{suggestedToday(){this.$store.dispatch({type:"getMovie",id:this.suggestedToday.id}).then(t=>this.movie=t)}},data:function(){return{movie:{}}},mounted(){}},m=d;var v=o(656),u=(0,v.A)(m,n,c,!1,null,"dfecc452",null);const p=u.exports;var f=function(){var t=this,e=t._self._c;return t.movie?e("b-modal",{attrs:{size:"lg",id:"detail-movie-modal",title:`Detalle: ${t.movie["Título"]}`,"ok-only":""}},[e("b-container",{attrs:{id:"detail-content"}},[t._l(t.movie,function(o,i){return["Enlace IMDb"!==i?e("b-row",{key:i},[e("b-col",{staticClass:"text-right",attrs:{cols:"4"}},[e("strong",[t._v(t._s(i))])]),e("b-col",{attrs:{cols:"8"}},["ID"===i?e("code",{staticClass:"text-truncate d-block"},[t._v(t._s(o))]):e("span",[t._v(t._s(o))])])],1):t._e()]}),t.suggestedToday&&t.suggestedToday.id===t.movie.ID?e("b-row",[e("b-col",{attrs:{cols:"4"}}),e("b-col",{staticClass:"text-left"},[e("b-badge",{attrs:{variant:"info"}},[t._v("SUGERIDA HOY")])],1)],1):t._e(),t.imdbLink(t.movie)?e("b-row",[e("b-col",{staticClass:"text-right",attrs:{cols:"4"}},[e("strong",[t._v("Enlace IMDb")])]),e("b-col",{attrs:{cols:"8"}},[e("a",{attrs:{target:"_blank",href:t.imdbLink(t.movie)}},[t._v(t._s(t.movie["Título"]))])])],1):t._e(),e("hr"),e("b-row",[e("b-col",{staticClass:"text-right",attrs:{cols:"4"}},[t._v(" Opciones ")]),e("b-col",[e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.edit-movie",modifiers:{"edit-movie":!0}}],staticClass:"mr-1",attrs:{variant:"info",size:"sm"},on:{click:function(e){return t.$emit("editMovie",t.movie.ID)}}},[e("b-icon-pencil"),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("Editar")])],1),e("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.$emit("removeMovie",t.movie.ID)}}},[e("b-icon-trash"),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("Eliminar")])],1)],1)],1)],2)],1):t._e()},h=[];const b={name:"DetailModal",props:["movie"],computed:{...(0,r.aH)(["suggestedToday"])},methods:{imdbLink:t=>0===t.ID.toString().indexOf("tt")?`https://imdb.com/title/${t.ID}`:t["Enlace IMDb"]?t["Enlace IMDb"]:""}},g=b;var w=(0,v.A)(g,f,h,!1,null,null,null);const C=w.exports;var _=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:"edit-movie",title:"Editar película"},on:{ok:function(e){return t.$emit("confirmEditMovie")},hidden:function(e){return t.$emit("resetEditMovie")}}},[e("b-row",[e("b-col",{attrs:{cols:"12"}},[t._v("id: "),e("code",[t._v(t._s(t.movie.id))])])],1),e("b-row",{staticClass:"mt-3"},[e("b-col",{attrs:{cols:"12"}},[e("b-input-group",{attrs:{size:"md",prepend:"Título"}},[e("b-form-input",{attrs:{id:"new-movie-title"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("confirmEditMovie")}},model:{value:t.movie.title,callback:function(e){t.$set(t.movie,"title",e)},expression:"movie.title"}})],1)],1),e("b-col",{staticClass:"mt-2",attrs:{cols:"12",sm:"6"}},[e("b-input-group",{attrs:{size:"md",prepend:"Precio",append:"€"}},[e("b-form-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("confirmEditMovie")}},model:{value:t.movie.cost,callback:function(e){t.$set(t.movie,"cost",e)},expression:"movie.cost"}})],1)],1),e("b-col",{staticClass:"mt-2",attrs:{cols:"12",sm:"6"}},[e("b-input-group",{attrs:{prepend:"Tienda"}},[e("b-form-select",{model:{value:t.movie.store,callback:function(e){t.$set(t.movie,"store",e)},expression:"movie.store"}},[e("b-form-select-option",{attrs:{value:""}}),t._l(t.stores,function(o,i){return e("b-form-select-option",{key:i,attrs:{value:i}},[t._v(t._s(o))])})],2)],1)],1)],1),e("b-row",{staticClass:"mt-2"},[e("b-col",[e("b-input-group",{attrs:{prepend:"Estrenada"}},[e("b-form-select",{model:{value:t.movie.watched,callback:function(e){t.$set(t.movie,"watched",e)},expression:"movie.watched"}},[e("b-form-select-option",{attrs:{value:"0"}},[t._v("No")]),e("b-form-select-option",{attrs:{value:"1"}},[t._v("Sí")])],1)],1)],1),e("b-col",[e("b-input-group",{attrs:{prepend:"Formato"}},[e("b-form-select",{model:{value:t.movie.format,callback:function(e){t.$set(t.movie,"format",e)},expression:"movie.format"}},t._l(t.formats,function(o,i){return e("b-form-select-option",{key:i,attrs:{value:i}},[t._v(t._s(o))])}),1)],1)],1)],1),e("b-row",[e("b-col",{staticClass:"mt-2",attrs:{cols:"12"}},[e("b-input-group",{attrs:{size:"md",prepend:"Link IMDb"}},[e("b-form-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("confirmEditMovie")}},model:{value:t.movie.imdbLink,callback:function(e){t.$set(t.movie,"imdbLink",e)},expression:"movie.imdbLink"}})],1)],1)],1),e("b-row",[e("b-col",{staticClass:"mt-2",attrs:{cols:"12"}},[e("b-input-group",{attrs:{size:"md",prepend:"Fecha añadida"}},[e("b-form-datepicker",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("confirmEditMovie")}},model:{value:t.movie.addDate,callback:function(e){t.$set(t.movie,"addDate",e)},expression:"movie.addDate"}})],1)],1)],1)],1)},k=[];const M={name:"DetailModal",props:["movie"],computed:{...(0,r.aH)(["stores","formats"])}},y=M;var D=(0,v.A)(y,_,k,!1,null,null,null);const x=D.exports;var T=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:"options-modal",title:"Opciones","ok-only":""}},[e("b-row",{staticClass:"mb-1"},[e("b-col",[e("b-alert",{attrs:{variant:"info",show:""}},[e("h4",[t._v("Exportación")]),t.exportCode?t._e():e("b-button",{attrs:{block:"",variant:"info"},on:{click:t.exportCollection}},[t._v("Exportar colección")]),t.exportCode?e("b-textarea",{attrs:{rows:"6",value:t.exportCode}}):t._e(),t.exportCode?e("b-button",{staticClass:"mt-1 mb-1",attrs:{block:"",variant:"success"},on:{click:t.downloadExportFile}},[t._v("Descargar archivo")]):t._e(),t.exportCode?e("b-button",{attrs:{block:""},on:{click:t.clearExportCode}},[t._v("Cerrar")]):t._e()],1)],1)],1),e("b-row",{staticClass:"mb-1"},[e("b-col",[e("b-alert",{attrs:{variant:"warning",show:""}},[e("h4",[t._v("Importación")]),t.showImportTextarea?t._e():e("b-button",{attrs:{block:"",variant:"warning"},on:{click:function(e){t.showImportTextarea=!0}}},[t._v("Importar colección")]),t.showImportTextarea?e("b-textarea",{attrs:{rows:"6"},model:{value:t.importCode,callback:function(e){t.importCode=e},expression:"importCode"}}):t._e(),t.showImportTextarea?[e("b-button",{staticClass:"mt-1 mb-1",attrs:{block:"",variant:"success",disabled:!t.importCode.length},on:{click:t.importCollection}},[t._v("Importar colección")]),e("hr"),e("div",{staticClass:"mt-1 mb-1"},[e("strong",[t._v("Importar desde archivo")]),e("input",{staticClass:"mt-2",attrs:{type:"file"},on:{change:t.importCollectionFile}})]),e("div",{staticClass:"mt-1 mb-1"},[e("strong",[t._v("Importar CSV de IMDB")]),e("input",{staticClass:"mt-2",attrs:{type:"file"},on:{change:t.readFile}})]),e("b-button",{staticClass:"mt-2",attrs:{block:""},on:{click:function(e){t.importCode="",t.showImportTextarea=!1}}},[t._v("Cerrar")])]:t._e(),t.importCode.length?e("div",{staticClass:"text-center mt-2"},[e("small",[e("strong",[t._v("¡Esto sobrescribirá la colección actual! ¡No se puede deshacer!")])])]):t._e()],2)],1)],1),e("b-row",[e("b-col",[e("b-alert",{attrs:{variant:"secondary",show:""}},[e("b-row",[e("b-col",{staticClass:"my-auto"},[t._v("Recalcular coste total de la colección")]),e("b-col",{attrs:{cols:"4"}},[e("b-button",{attrs:{block:"",variant:"primary"},on:{click:t.recalcTotalSpent}},[t._v("Recalcular")])],1)],1)],1)],1)],1),e("b-row",[e("b-col",[e("b-alert",{attrs:{variant:"danger",show:""}},[e("h5",[e("b-icon-exclamation-triangle"),t._v(" Zona peligrosa ")],1),e("hr"),e("b-button",{attrs:{variant:"danger",block:""},on:{click:t.clearCollection}},[t._v("Eliminar la colección al completo")])],1)],1)],1)],1)},E=[];const $={name:"OptionsModal",mixins:[l],computed:{...(0,r.aH)(["movieCollection","totalSpent"])},data:function(){return{showImportTextarea:!1,importCode:"",exportCode:"",importListUrl:""}},methods:{recalcTotalSpent(){this.$store.commit("forceRecalcTotalSpent"),this.showToast("Correcto","Se ha recalculado el gasto total con éxito","success")},downloadExportFile(){if(!this.exportCode)return!1;const t=document.createElement("a"),e=new Date,o=[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-");t.download=`pelis_export_${o}.csv`,t.href=`data:text/csv;charset=utf-8,${this.jsonToCsv(this.movieCollection.map(this.formatMovie))}`,t.click()},importCollectionFile(t){const e=new FileReader;e.onload=t=>{const e=this.csvToArray(t.target.result);e.shift();const o=e.filter(t=>t.length>5).map(t=>{const e=!t[5].includes("T");return{id:t[0],title:t[1]||"",cost:t[2]||0,store:t[3]||"",imdbLink:t[4]||"",addDate:new Date(e?+t[5]:t[5])||new Date,watched:"true"===t[6],format:t[7]||"br"}});this.$store.commit("importCollection",o),this.showToast("Importado","Colección importada con éxito","success")},e.readAsText(t.target.files[0])},importJSONFile(t){const e=t.target.files[0],o=new FileReader;o.onload=()=>{const t=JSON.parse(o.result);this.$store.commit("importCollection",t.movieCollection.map(t=>(t.title.includes("�")&&(t.title=t.title.replace("�","")),t)))},o.readAsText(e,"UTF-8")},readFile:async function(t){const e=t.target.files[0],o=new FileReader;o.onload=()=>{this.readImdbCSV(o.result)},o.readAsText(e,"UTF-8")},clearCollection(){confirm("Vas a ELIMINAR POR COMPLETO la colección ¿estás seguro/a?")&&(this.$store.commit("clearCollection"),this.showToast("Colección eliminada","Se ha eliminado la colección al completo","success"))},exportCollection(){const t=JSON.stringify({movieCollection:this.movieCollection.map(this.formatMovie),totalSpent:this.totalSpent});this.exportCode=btoa(t)},clearExportCode(){this.exportCode=""},importCollection(){const t=atob(this.importCode);try{const e=JSON.parse(t);e.movieCollection=e.movieCollection.map(t=>("undefined"===typeof t.watched?t.watched=1:t.watched=!!+t.watched,t.addDate?t.addDate=new Date(t.addDate):t.addDate=Date.now(),t)),this.$store.commit("importCollection",e.movieCollection),this.showToast("Importado","Colección importada con éxito","success")}catch(e){console.error(e)}}}},S=$;var I=(0,v.A)(S,T,E,!1,null,null,null);const O=I.exports;var P=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{title:"Añadir película",id:"add-movie-modal"}},[e("b-input-group",{attrs:{size:"md",prepend:"Título"}},[e("b-form-input",{attrs:{id:"new-movie-title-modal"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addMovie.apply(null,arguments)}},model:{value:t.movie.title,callback:function(e){t.$set(t.movie,"title",e)},expression:"movie.title"}})],1),e("b-input-group",{staticClass:"mt-2",attrs:{size:"md",prepend:"Precio",append:"€"}},[e("b-form-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addMovie.apply(null,arguments)}},model:{value:t.movie.cost,callback:function(e){t.$set(t.movie,"cost",e)},expression:"movie.cost"}})],1),e("b-input-group",{staticClass:"mt-2",attrs:{prepend:"Tienda"}},[e("b-form-select",{model:{value:t.movie.store,callback:function(e){t.$set(t.movie,"store",e)},expression:"movie.store"}},[e("b-form-select-option",{attrs:{value:""}}),t._l(t.stores,function(o,i){return e("b-form-select-option",{key:i,attrs:{value:i}},[t._v(t._s(o))])})],2)],1),e("b-input-group",{staticClass:"mt-2",attrs:{prepend:"Formato"}},[e("b-form-select",{model:{value:t.movie.format,callback:function(e){t.$set(t.movie,"format",e)},expression:"movie.format"}},[e("b-form-select-option",{attrs:{value:""}}),t._l(t.formats,function(o,i){return e("b-form-select-option",{key:i,attrs:{value:i}},[t._v(t._s(o))])})],2)],1),e("b-input-group",{staticClass:"mt-2",attrs:{size:"md",prepend:"IMDb link"}},[e("b-form-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addMovie.apply(null,arguments)}},model:{value:t.movie.imdbLink,callback:function(e){t.$set(t.movie,"imdbLink",e)},expression:"movie.imdbLink"}})],1),e("b-row",[e("b-col",{staticClass:"text-center mt-3",attrs:{sm:"12",md:"6","offset-md":"3"}},[e("b-button",{attrs:{block:"",variant:"success"},on:{click:t.addMovie}},[t._v("Añadir a la colección")])],1)],1)],1)},L=[];const A={name:"AddMovieModal",mixins:[l],computed:{...(0,r.aH)(["stores","formats"])},data:function(){return{movie:{title:"",cost:0,store:"",imdbLink:"",format:""}}},methods:{addMovie(){const t=this;if(!this.movie.title)return!1;this.$store.commit("addMovie",{title:t.movie.title,cost:t.movie.cost,store:t.movie.store,imdbLink:t.movie.imdbLink,format:t.movie.format||"br"}),document.querySelector("#new-movie-title-modal").focus(),this.showToast("Añadida",`Se ha añadido "${this.movie.title}" a la colección con un coste de ${this.movie.cost}€`,"success"),this.movie.title="",this.movie.cost=0,this.movie.store="",this.movie.imdbLink="",this.movie.format=""}}},F=A;var N=(0,v.A)(F,P,L,!1,null,null,null);const R=N.exports;var j=function(){var t=this,e=t._self._c;return e("b-alert",{attrs:{variant:"info",show:""}},[e("strong",[t._v("Resumen")]),e("hr"),e("div",[t._v("Total de películas: "),e("strong",[t._v(t._s(t.totalMovies))])]),t.giftMovies?e("div",[t._v("Películas que me han regalado: "),e("strong",[t._v(t._s(t.giftMovies))])]):t._e(),t.unwatchedMovies?e("div",[t._v("Películas por estrenar: "),e("strong",[t._v(t._s(t.unwatchedMovies))])]):t._e(),e("div",[t._v("Dinero total invertido: "),e("strong",[t._v(t._s(t.totalSpent)+" €")])]),e("hr"),t._l(t.byFormat,function(o,i){return e("div",{key:i},[t._v("Total en "+t._s(t.formats[i])+": "),e("strong",[t._v(t._s(o))])])})],2)},z=[];const H={name:"Resume",computed:{...(0,r.aH)(["formats"])},props:["totalMovies","giftMovies","unwatchedMovies","totalSpent","byFormat"]},q=H;var J=(0,v.A)(q,j,z,!1,null,null,null);const V=J.exports;var G=function(){var t=this,e=t._self._c;return e("nav",{staticClass:"navbar navbar-dark bg-dark mb-3"},[e("b-container",[e("a",{staticClass:"navbar-brand",attrs:{href:"#"}},[e("b-icon-film",{staticClass:"yellowgreen"}),t._v(" "),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("COLECCIÓN DE PELIS")])],1),e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.add-movie-modal",modifiers:{"add-movie-modal":!0}}],staticClass:"d-inline-block d-sm-none",attrs:{variant:"success"}},[e("b-icon-plus")],1),e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.options-modal",modifiers:{"options-modal":!0}}]},[e("b-icon-gear-fill"),t._v(" "),e("span",{staticClass:"d-none d-sm-inline-block"},[t._v("Opciones")])],1)],1)],1)},U=[];const B={name:"Nav"},Y=B;var Z=(0,v.A)(Y,G,U,!1,null,null,null);const K=Z.exports,Q={name:"App",components:{SuggestedMovie:p,DetailModal:C,EditModal:x,OptionsModal:O,AddMovieModal:R,Resume:V,Nav:K},mixins:[l],computed:{...(0,r.aH)(["movieCollection","totalSpent","suggestedToday","stores","exportCode","importCode","showImportTextarea","formats"]),hasAnyFilter(){return this.filters.title.length||this.filters.cost.length||this.filters.store.length}},watch:{movieCollection(){this.filterCollection()},hasAnyFilter(){this.filterCollection()},"filters.watched":function(){this.filterCollection()},qtyPerPage(){this.page=1,this.filterCollection()},"filters.sort.field":function(){this.filterCollection()},"filters.sort.order":function(){this.filterCollection()}},data:function(){return{page:1,qtyPerPage:15,addMovieData:{title:"",cost:0,store:"",imdbLink:""},editMovieData:{id:"",title:"",cost:"",watched:0,store:"",imdbLink:"",addDate:null,format:""},showFilters:!1,filters:{title:"",cost:"",watched:null,sort:{field:"addDate",order:1},store:"",format:""},detailMovie:null,filteredResults:{items:{},count:0}}},methods:{changePage(t){this.page=t,this.filterCollection()},showMovie(t){this.detailMovie={ID:t.id,Título:t.title,Coste:t.cost+" €",Tienda:this.stores[t.store],Estrenada:+t.watched?"Sí":"No","Fecha de inclusión":this.formatDate(t.addDate),"Enlace IMDb":t.imdbLink}},totalMovies(){return Array.isArray(this.movieCollection)?this.movieCollection.length:0},giftMovies(){let t=0;for(let e in this.movieCollection)0===+this.movieCollection[e].cost&&t++;return t},unwatchedMovies(){return Object.values(this.movieCollection).reduce((t,e)=>(+e.watched||t++,t),0)},countByFormat(){const t={};for(let e in this.movieCollection){const o=this.movieCollection[e];t[o.format]?t[o.format]++:t[o.format]=1}return t},formatDate(t){return new Date(t).toLocaleString().split(", ").shift()},sortItems(t){const e=this.filters.sort.order;return t.sort((t,o)=>t[this.filters.sort.field]>o[this.filters.sort.field]?e:t[this.filters.sort.field]<o[this.filters.sort.field]?-1*e:0)},filterCollection(){if(!this.movieCollection||!this.movieCollection.length)return!1;let t=this.movieCollection.slice().filter(this.filterItem);this.filters.sort.field&&(t=this.sortItems(t)),t=t.reverse();const e=t.length;t=t.splice(this.qtyPerPage*(this.page-1),this.qtyPerPage),this.filteredResults={items:t,count:e}},filterItem(t){let e=!0;return this.filters.title&&(t.title.toLowerCase().includes(this.filters.title.toLowerCase())||(e=!1)),this.filters.cost&&(this.evalCostFilter(t)||(e=!1)),null!==this.filters.watched&&+this.filters.watched!==+(t.watched||0)&&(e=!1),this.filters.store&&t.store!==this.filters.store&&(e=!1),e},evalCostFilter(t){if(this.filters.cost.includes("&")){const e=this.filters.cost.split("&");return+t.cost>+e[0]&&+t.cost<+e[1]}return this.filters.cost.includes("<")?+t.cost<+this.filters.cost.replace("<",""):this.filters.cost.includes(">")?+t.cost>+this.filters.cost.replace(">",""):+t.cost===+this.filters.cost},addMovie(){const t=this;if(!this.addMovieData.title)return!1;this.$store.commit("addMovie",{title:t.addMovieData.title,cost:t.addMovieData.cost,store:t.addMovieData.store,imdbLink:t.addMovieData.imdbLink}),document.querySelector("#new-movie-title").focus(),this.showToast("Añadida",`Se ha añadido "${this.addMovieData.title}" a la colección con un coste de ${this.addMovieData.cost}€`,"success"),this.addMovieData.title="",this.addMovieData.cost=0,this.addMovieData.store="",this.addMovieData.imdbLink=""},clearCollection(){confirm("Vas a ELIMINAR POR COMPLETO la colección ¿estás seguro/a?")&&(this.$store.commit("clearCollection"),this.showToast("Colección eliminada","Se ha eliminado la colección al completo","success"))},removeMovie(t){this.$store.dispatch({type:"getMovie",id:t}).then(e=>{const o=e.title;confirm(`¿Eliminar de la colección "${o}"?`)&&(this.$store.commit("removeMovie",t),this.showToast("Eliminado",`Has eliminado "${o}"`,"success"))})},exportCollection(){const t=JSON.stringify({movieCollection:this.movieCollection,totalSpent:this.totalSpent});this.exportCode=btoa(t)},clearExportCode(){this.exportCode=""},importCollection(){const t=atob(this.importCode);try{const e=JSON.parse(t);e.movieCollection=e.movieCollection.map(t=>("undefined"===typeof t.watched?t.watched=1:t.watched=!!+t.watched,t.addDate?t.addDate=+t.addDate:t.addDate=Date.now(),t)),this.$store.commit("importCollection",e),this.showToast("Importado","Colección importada con éxito","success")}catch(e){console.error(e)}},editMovie(t){this.$store.dispatch({type:"getMovie",id:t}).then(t=>{this.editMovieData.id=t.id,this.editMovieData.title=t.title,this.editMovieData.cost=+t.cost,this.editMovieData.watched=+t.watched,this.editMovieData.store=t.store,this.editMovieData.imdbLink=t.imdbLink,this.editMovieData.addDate=new Date(t.addDate),this.editMovieData.format=t.format})},confirmEditMovie(){this.$store.commit("editMovie",{id:this.editMovieData.id,title:this.editMovieData.title,cost:+this.editMovieData.cost,watched:1===+this.editMovieData.watched,store:this.editMovieData.store,imdbLink:this.editMovieData.imdbLink,addDate:new Date(this.editMovieData.addDate),format:this.editMovieData.format}),this.showToast("Editado",`Se ha editado correctamente "${this.editMovieData.title}"`,"success")},resetEditMovie(){this.editMovieData.id="",this.editMovieData.title="",this.editMovieData.cost="",this.editMovieData.store="",this.editMovieData.format=""},showToast(t,e,o){this.$bvToast.toast(e,{title:t,variant:o,solid:!0,toaster:"b-toaster-top-center"})},showMovieModal(t){this.showMovie(t),this.$bvModal.show("detail-movie-modal")}},mounted(){this.filterCollection()}},W=Q;var X=(0,v.A)(W,s,a,!1,null,null,null);const tt=X.exports,et="https://pelis-api-hazel.vercel.app/api",ot={"Content-Type":"application/json"},it=async t=>{const e=t,o=await fetch(`${et}/movies`,{method:"POST",headers:ot,body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()},st=async()=>{const t=await fetch(`${et}/movies`,{method:"GET",headers:ot});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()},at=async t=>{const e=await fetch(`${et}/movies/${t}`,{method:"GET",headers:ot});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()},rt=async t=>{const e=await fetch(`${et}/movies/${t}`,{method:"DELETE",headers:ot});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return 204===e.status},lt=async(t,e)=>{e.id&&delete e.id;const o=await fetch(`${et}/movies/${t}`,{method:"PUT",headers:ot,body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return 200===o.status},nt=async()=>{const t=await fetch(`${et}/movies/`,{method:"DELETE",headers:ot});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return 200===t.status},ct={movieCollection:{},totalSpent:0,suggestedToday:{date:null,id:""},stores:{amazon:"Amazon",elcorteingles:"El corte Inglés",fnac:"Fnac",cex:"Cex",carrefour:"Carrefour",selectavision:"Selecta Visión",mediamarkt:"Mediamarkt",game:"Game",centromail:"Centro Mail"},formats:{br:"Bluray",dvd:"DVD"}},dt=function(t){gt().then(t=>{if(ct.movieCollection=t,!t.length)return!1;ct.totalSpent=mt(ct);const e=Ct("config.suggestedToday");if(e&&ut(e.date))ft(e.id).then(e=>{if(e)ct.suggestedToday={date:e.date,id:e.id};else{const e={date:Date.now(),id:t[vt(0,t.length-1)].id};ct.suggestedToday=e,_t("config.suggestedToday",e)}});else{const e={date:Date.now(),id:t[vt(0,t.length-1)].id};ct.suggestedToday=e,_t("config.suggestedToday",e)}}).catch(console.error)},mt=t=>t.movieCollection.reduce((t,e)=>(t+=+e.cost,t),0),vt=(t,e)=>Math.round(t+Math.random()*(e-t)),ut=t=>{const e=new Date(+t).toLocaleString().split(" ").shift(),o=(new Date).toLocaleString().split(" ").shift();return e===o},pt=t=>new Promise((e,o)=>{Array.isArray(t)?(t.forEach(async t=>{try{await it(t)}catch(e){o(e)}}),e(t)):it(t).then(e).catch(o)}),ft=t=>new Promise((e,o)=>{at(t).then(e).catch(o)}),ht=t=>new Promise((e,o)=>{rt(t).then(e).catch(o)}),bt=(t,e)=>new Promise((o,i)=>{lt(t,e).then(o).catch(i)}),gt=()=>new Promise((t,e)=>{st().then(e=>{e=e.map(t=>(t.addDate=new Date(t.addDate),t)),t(e)}).catch(e)}),wt=()=>new Promise((t,e)=>{nt().then(t).catch(e)}),Ct=t=>JSON.parse(window.localStorage.getItem(t)),_t=(t,e)=>window.localStorage.setItem(t,JSON.stringify(e)),kt=ct;dt(),i["default"].use(r.Ay);const Mt=new r.Ay.Store({state:kt,mutations:{setCollection(t,e){t.movieCollection=e},addMovie:async(t,e)=>{e.addDate||(e.addDate=Date.now()),pt(e).then(e=>{t.movieCollection.push(e),t.totalSpent+=+e.cost})},clearCollection(t){wt().then(()=>{location.reload(),t.movieCollection={},t.totalSpent=0})},removeMovie(t,e){ht(e).then(()=>{const o=t.movieCollection.findIndex(t=>t.id===e);i["default"].delete(t.movieCollection,o),t.totalSpent=mt(t)})},importCollection(t,e){wt().then(o=>{pt(e).then(o=>{t.movieCollection=e,t.totalSpent=mt(t)})})},editMovie(t,e){bt(e.id,e).then(o=>{const s=t.movieCollection.findIndex(t=>t.id===e.id);i["default"].set(t.movieCollection,s,o),t.totalSpent=mt(t)})},forceRecalcTotalSpent(t){t.totalSpent=mt(t)}},actions:{getMovie({commit:t,state:e},o){return ft(o.id)}},modules:{},plugins:[]});var yt=o(413),Dt=o(625);i["default"].config.productionTip=!1,i["default"].use(yt.vGs),i["default"].use(Dt.YS),new i["default"]({store:Mt,render:function(t){return t(tt)}}).$mount("#app")}},e={};function o(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,o),a.exports}o.m=t,(()=>{var t=[];o.O=(e,i,s,a)=>{if(!i){var r=1/0;for(d=0;d<t.length;d++){for(var[i,s,a]=t[d],l=!0,n=0;n<i.length;n++)(!1&a||r>=a)&&Object.keys(o.O).every(t=>o.O[t](i[n]))?i.splice(n--,1):(l=!1,a<r&&(r=a));if(l){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[i,s,a]}})(),(()=>{o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}})(),(()=>{o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{o.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{var t={524:0};o.O.j=e=>0===t[e];var e=(e,i)=>{var s,a,[r,l,n]=i,c=0;if(r.some(e=>0!==t[e])){for(s in l)o.o(l,s)&&(o.m[s]=l[s]);if(n)var d=n(o)}for(e&&e(i);c<r.length;c++)a=r[c],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(d)},i=self["webpackChunkpelis"]=self["webpackChunkpelis"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var i=o.O(void 0,[504],()=>o(864));i=o.O(i)})();
//# sourceMappingURL=app.e5cdc55c.js.map